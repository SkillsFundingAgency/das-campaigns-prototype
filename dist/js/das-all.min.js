(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports):typeof define==="function"&&define.amd?define("DASFrontend",["exports"],t):t(e.DASFrontend={})})(this,function(e){"use strict";function t(e){this.$module=e;this.$sections=e.querySelectorAll(".govuk-accordion__section");this.$openAllButton=""}function i(e,t){if(window.NodeList.prototype.forEach){return e.forEach(t)}for(var i=0;i<e.length;i++){t.call(window,e[i],i,e)}}t.prototype.init=function(){var e=this.$module;if(!e){return}this.moduleId=e.getAttribute("id");i(this.$sections,function(e,t){var i=e.querySelector(".govuk-accordion__section-header");this.setHeaderAttributes(i,t);this.setExpanded(this.isExpanded(e),e);i.addEventListener("click",this.onToggleExpanded.bind(this,e))}.bind(this));this.$openAllButton=document.createElement("button");this.setOpenAllButtonAttributes(this.$openAllButton);var t=document.createElement("div");t.setAttribute("class","govuk-accordion__controls");t.appendChild(this.$openAllButton);this.$module.insertBefore(t,this.$module.firstChild);this.$module.classList.add("with-js");this.$openAllButton.addEventListener("click",this.openOrCloseAllSections.bind(this));this.readState();var o=this.checkIfAllSectionsOpen();this.updateOpenAllButton(o)};t.prototype.onToggleExpanded=function(e){var t=this.isExpanded(e);this.setExpanded(!t,e);this.storeState();var i=this.checkIfAllSectionsOpen();this.updateOpenAllButton(i)};t.prototype.setExpanded=function(e,t){var i=t.querySelector(".govuk-accordion__section-header-button");i.setAttribute("aria-expanded",e);if(e){t.classList.add("govuk-accordion__section--expanded")}else{t.classList.remove("govuk-accordion__section--expanded")}this.$module.className=this.$module.className};t.prototype.isExpanded=function(e){return e.classList.contains("govuk-accordion__section--expanded")};t.prototype.setHeaderAttributes=function(e,t){var i=e.querySelector(".govuk-accordion__section-header-button");var o=document.createElement("button");o.setAttribute("class",i.getAttribute("class"));o.setAttribute("aria-controls",this.moduleId+"-panel-"+(t+1));for(var n=0;n<i.childNodes.length;n++){var s=i.childNodes[n];i.removeChild(s);o.appendChild(s)}e.removeChild(i);e.appendChild(o);var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("width","16");a.setAttribute("height","16");a.setAttribute("viewBox","0 0 32 32");a.setAttribute("class","govuk-accordion--icon");a.innerHTML=' <path class="govuk-accordion--icon-open" d="M13.3721 -7.11581e-08L7.48837 5.84655L1.5814 -5.86546e-07L-6.9424e-08 1.58823L7.51163 9L15 1.61125L13.3721 -7.11581e-08Z"/><rect class="govuk-accordion--icon-close" x="1.58691" y="0.0893555" width="16.0371" height="2.16583" transform="rotate(45 1.58691 0.0893555)"/><rect class="govuk-accordion--icon-close" x="0.0966797" y="11.34" width="16.0371" height="2.16583" transform="rotate(-45 0.0966797 11.34)"/>';e.appendChild(a)};t.prototype.setOpenAllButtonAttributes=function(e){e.textContent="Open all";e.setAttribute("class","govuk-accordion__expand-all");e.setAttribute("aria-expanded","false");e.setAttribute("type","button")};t.prototype.openOrCloseAllSections=function(){var e=this;var t=this.$sections;var o=!(e.$openAllButton.getAttribute("aria-expanded")==="true");i(t,function(t){e.setExpanded(o,t)});e.updateOpenAllButton(o)};t.prototype.updateOpenAllButton=function(e){var t=e?"Close all":"Open all";this.$openAllButton.setAttribute("aria-expanded",e);this.$openAllButton.textContent=t};t.prototype.checkIfAllSectionsOpen=function(){var e=this;var t=this.$sections;var o=this.$sections.length;var n=0;var s=false;i(t,function(t){if(e.isExpanded(t)){n++}});s=o===n;return s};var o={checkForSessionStorage:function(){var e="this is the test string";var t;try{window.sessionStorage.setItem(e,e);t=window.sessionStorage.getItem(e)===e.toString();window.sessionStorage.removeItem(e);return t}catch(e){}}};t.prototype.storeState=function(){if(o.checkForSessionStorage()){i(this.$sections,function(e){var t=e.querySelector("h2 [aria-controls]")?e.querySelector("h2 [aria-controls]").getAttribute("aria-controls"):false;var i=e.querySelector("h2 [aria-expanded]")?e.querySelector("h2 [aria-expanded]").getAttribute("aria-expanded"):false;if(t===false&&console){console.error(new Error("No aria controls present in accordion heading."))}if(i===false&&console){console.error(new Error("No aria expanded present in accordion heading."))}if(t&&i){window.sessionStorage.setItem(t,i)}})}};t.prototype.readState=function(){if(o.checkForSessionStorage()){i(this.$sections,function(e){var t=e.querySelector("h2 [aria-controls]")?e.querySelector("h2 [aria-controls]").getAttribute("aria-controls"):false;var i;if(t){i=window.sessionStorage.getItem(t)}if(i!==null){var o=i==="true";this.setExpanded(o,e)}}.bind(this))}};function n(e){this.$module=e;this.$navToggle=e.querySelector(".navigation__toggle");this.$navItems=e.querySelectorAll(".navigation__list-item")}function s(e,t){if(window.NodeList.prototype.forEach){return e.forEach(t)}for(var i=0;i<e.length;i++){t.call(window,e[i],i,e)}}n.prototype.init=function(){var e=this.$module;if(!e){return}if(this.$navToggle!=undefined){this.$navToggle.addEventListener("click",this.onToggleNav.bind(this,this.$navToggle))}s(this.$navItems,function(e,t){this.$subnavToggle=e.querySelector(".navigation__sub-menu-toggle");if(this.$subnavToggle!=undefined){this.$subnavToggle.addEventListener("click",this.onToggleSubNav.bind(this,e))}}.bind(this))};n.prototype.onToggleNav=function(){var e=document.querySelector("body");e.classList.toggle("js-menu-open")};n.prototype.onToggleSubNav=function(e,t){t.preventDefault();e.querySelector(".navigation__link--top-level").classList.toggle("sub-menu-open");e.querySelector(".navigation__sub-menu").classList.toggle("js-show")};function a(e){this.$dropCookie=true;this.$cookieDuration=365;this.$cookieName="CookieConsent";this.$cookieValue="true";this.$cookieBanner=e;this.$cookieBannerParent=this.$cookieBanner.parentNode;this.$cookieBannerContinue=document.querySelector(".cookiebanner__button--continue");this.$cookieBannerClose=document.querySelector(".cookiebanner--close");this.$cookieModal=document.getElementById("modal-cookiesettings");this.$MarketingcookieName="MarketingConsent";this.$MarketingcookieValue="false";this.$Marketingcheckbox=document.getElementById("cbxMarketingConsent");this.$AnalyticscookieName="AnalyticsConsent";this.$AnalyticscookieValue="true";this.$AnalyticsCheckbox=document.getElementById("cbxAnalyticsConsent")}a.prototype.init=function(){if(this.checkCookie(this.$MarketingcookieName)==null){this.createCookie(this.$MarketingcookieName,this.$MarketingcookieValue,this.$cookieDuration)}if(this.checkCookie(this.$AnalyticscookieName)==null){this.createCookie(this.$AnalyticscookieName,this.$AnalyticscookieValue,this.$cookieDuration)}if(this.checkCookie(this.$cookieName)==this.$cookieValue){this.removeBanner();this.removeModal()}else{this.showBanner();this.$cookieBannerContinue.addEventListener("click",this.removeBannerEvent.bind(this,true));this.$cookieBannerClose.addEventListener("click",this.removeBannerEvent.bind(this,false))}if(this.$Marketingcheckbox!=null&&this.$AnalyticsCheckbox!=null){this.$Marketingcheckbox.checked=this.checkCookie(this.$MarketingcookieName)==="true";this.$AnalyticsCheckbox.checked=this.checkCookie(this.$AnalyticscookieName)==="true"}};a.prototype.removeBannerEvent=function(e,t){this.createCookie(this.$cookieName,this.$cookieValue,this.$cookieDuration);if(e){this.createCookie(this.$MarketingcookieName,"true",this.$cookieDuration);this.createCookie(this.$AnalyticscookieName,"true",this.$cookieDuration);this.removeModal()}this.removeBanner()};a.prototype.showBanner=function(){if(this.$cookieBanner!==null){var e=this.$cookieBanner.getAttribute("class").replace(" visually-hidden","");this.$cookieBanner.setAttribute("class",e)}};a.prototype.setChecked=function(e,t){var i=e.checked?"true":"false";this.createCookie(t,i,this.$cookieDuration)};a.prototype.createCookie=function(e,t,i){if(i){var o=new Date;o.setTime(o.getTime()+i*24*60*60*1e3);var n="; expires="+o.toGMTString()}else var n="";if(this.$dropCookie){document.cookie=e+"="+t+n+"; path=/"}};a.prototype.checkCookie=function(e){var t=e+"=";var i=document.cookie.split(";");for(var o=0;o<i.length;o++){var n=i[o];while(n.charAt(0)==" ")n=n.substring(1,n.length);if(n.indexOf(t)==0)return n.substring(t.length,n.length)}return null};a.prototype.eraseCookie=function(e){this.createCookie(e,"",-1)};a.prototype.removeBanner=function(){if(this.$cookieBanner!==null)this.$cookieBannerParent.removeChild(this.$cookieBanner);if(this.$Marketingcheckbox!=null){this.$Marketingcheckbox.addEventListener("click",this.setChecked.bind(this,this.$Marketingcheckbox,this.$MarketingcookieName))}if(this.$AnalyticsCheckbox){this.$AnalyticsCheckbox.addEventListener("click",this.setChecked.bind(this,this.$AnalyticsCheckbox,this.$AnalyticscookieName))}};a.prototype.removeModal=function(){if(this.$cookieModal!==null)this.$cookieBannerParent.removeChild(this.$cookieModal)};function r(e){this.$trackingEnabled=e!=null;this.$DataLayer=e}r.prototype.sendEvent=function(e,t){t.event=e;var i=JSON.stringify(t);this.$DataLayer.push(t)};function l(e,t){this.$module=e;this.$videoPlayerId=this.$module.dataset.videoplayerid;this.$videoUrl=this.$module.dataset.videourl;this.$player=null;this.$playerElement=null;this.$playerClass=this.$module.dataset.playerclass;this.$videoPlayerTemplate='<div class="video-player plyr__video-embed js-player visually-hidden" id="{videoPlayerId}"><div class="video-player--inner-wrap"><a class="video-player__close" href="#"><span class="video-player__close-icon"></span> Close</a><iframe src="{videoUrl}" allowfullscreen allowtransparency allow="autoplay"></iframe></div></div>';this.$trackingEnabled=t!=null;this.$gtmDataLayer=t;this.$gtm=null;this.$playingTimer=null;this.$playingTimerTimespan=5e3}l.prototype.init=function(){var e=this.$module;if(!e){return}this.appendPlayer();this.$playerElement=document.getElementById(this.$videoPlayerId);if(this.$playerClass!=null){this.$playerElement.classList.add(this.$playerClass)}this.$player=new Plyr(this.$playerElement);var t="click";if(this.$player.touch==true){t="touchstart"}this.$module.addEventListener(t,this.play.bind(this));this.$closeButton=this.$playerElement.querySelector(".video-player__close");this.$closeButton.addEventListener(t,this.close.bind(this));this.$module.classList.toggle("visually-hidden");if(this.$trackingEnabled){this.$gtm=new r(this.$gtmDataLayer);this.enableEvents()}};l.prototype.appendPlayer=function(){var e=this.$videoPlayerTemplate.replace("{videoPlayerId}",this.$videoPlayerId).replace("{videoUrl}",this.$videoUrl);window.document.body.insertAdjacentHTML("beforeend",e)};l.prototype.close=function(){if(this.$player.fullscreen.active){this.$player.fullscreen.exit()}this.$player.stop()};l.prototype.play=function(e){this.$player.play();if(this.isSmallScreen()){this.$player.fullscreen.enter()}e.preventDefault()};l.prototype.isSmallScreen=function(){return window.innerWidth<900};l.prototype.enableEvents=function(){this.$player.on("play",e=>{if(this.$player.currentTime==0){this.sendEvent("video_started")}else{this.sendEvent("video_play")}this.$playingTimer=setInterval(this.sendPlayingEvent.bind(this,this),this.$playingTimerTimespan)});this.$player.on("ended",e=>{this.sendEvent("video_ended");clearInterval(this.$playingTimer)});this.$player.on("pause",e=>{this.sendEvent("video_paused");clearInterval(this.$playingTimer)})};l.prototype.sendEvent=function(e){var t={currentTimestamp:c(this.$player.currentTime,1),totalVideoPlayed:c(this.$player.currentTime/this.$player.duration,2),totalVideoDuration:this.$player.duration,videoId:this.$player.embed.getVideoData().video_id};this.$gtm.sendEvent(e,t)};l.prototype.sendPlayingEvent=function(e){e.sendEvent("video_playing")};function c(e,t){var i=Math.pow(10,t||0);return Math.round(e*i)/i}function d(e){this.$module=e;this.$anchorLinks=e.querySelectorAll('a[href^="#"]')}d.prototype.init=function(e,t){this.$anchorLinks.forEach(e=>{var t=document.querySelector(e.hash);if(t!=null){e.addEventListener("click",this.smoothScroll.bind(this,t,500,"easeInOutQuart",null))}})};d.prototype.smoothScroll=function(e,t=500,i="easeInOutQuart",o){const n={easeInOutQuart(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}};const s=window.pageYOffset;const a="now"in window.performance?performance.now():(new Date).getTime();const r=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight);const l=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight;const c=(typeof e==="number"?e:e.offsetTop)-150;const d=Math.round(r-c<l?r-l:c);if("requestAnimationFrame"in window===false){window.scroll(0,d);if(o){o()}return}function h(){const e="now"in window.performance?performance.now():(new Date).getTime();const r=Math.min(1,(e-a)/t);const l=n[i](r);window.scroll(0,Math.ceil(l*(d-s)+s));if(window.pageYOffset===d){if(o){o()}return}requestAnimationFrame(h)}h()};function h(e,t){if(window.NodeList.prototype.forEach){return e.forEach(t)}for(var i=0;i<e.length;i++){t.call(window,e[i],i,e)}}function u(){var e=document.querySelectorAll('[data-module="accordion"]');h(e,function(e){new t(e).init()});var i=document.querySelectorAll('[data-module="navigation"]');h(i,function(e){new n(e).init()});var o=document.querySelector('[data-module="cookieBanner"]');if(o!=null){new a(o).init()}var s=window.dataLayer;var r=document.querySelectorAll('[data-module="videoPlayer"]');r.forEach(function(e){new l(e,s).init()});var c=document.querySelectorAll('[data-module="smoothScroll"]');c.forEach(function(e){new d(e).init()});if(typeof aspnetValidation!="undefined"){let e=new aspnetValidation.ValidationService;e.bootstrap()}}e.initAll=u;e.Accordion=t;e.Navigation=n;e.CookieBanner=a;e.VideoPlayer=l});
